# ClickStream Dataflow (Field vs Stage)

| Field / Block                | Frontend payload                                      | Raw S3 (after Ingest)                                               | DW (PostgreSQL)                               | Notes                                   |
| ---                          | ---                                                   | ---                                                                 | ---                                           | ---                                     |
| event_id                     | `eventId` generated on client                         | same as payload                                                     | `event_id` (maps from eventId; ETL fallback UUID) | Primary key, ON CONFLICT DO NOTHING     |
| event_timestamp              | -                                                     | - (S3 LastModified exists)                                          | `_ingest.receivedAt` > payload > LastModified | Derived by ETL                          |
| event_name                   | `eventName`                                           | `eventName`                                                         | `event_name`                                  |                                           |
| page_url                     | `pageUrl`                                             | `pageUrl`                                                           | -                                             | Not stored in DW                        |
| referrer                     | `referrer`                                            | `referrer`                                                          | -                                             | Not stored in DW                        |
| user_id                      | `userId`                                              | `userId`                                                            | `user_id`                                     |                                           |
| user_login_state             | `userLoginState`                                      | `userLoginState`                                                    | `user_login_state`                            |                                           |
| identity_source              | optional                                              | optional                                                            | `identity_source`                             | Needs frontend/auth to populate         |
| client_id                    | `clientId`                                            | `clientId`                                                          | `client_id`                                   |                                           |
| session_id                   | `sessionId`                                           | `sessionId`                                                         | `session_id`                                  |                                           |
| is_first_visit               | `isFirstVisit`                                        | `isFirstVisit`                                                      | `is_first_visit`                              |                                           |
| product id                   | `product.id`                                          | `product.id`                                                        | `context_product_id`                          |                                           |
| product name                 | `product.name`                                        | `product.name`                                                      | `context_product_name`                        |                                           |
| product category             | `product.category`                                    | `product.category`                                                  | `context_product_category`                    |                                           |
| product brand                | `product.brandName` / `brand?.name` / `brand` / `brand?.title` | `product.brand` or `product.brandName`                              | `context_product_brand`                       | Frontend maps brand from DB fields      |
| product price                | `product.price`                                       | `product.price`                                                     | `context_product_price`                       | BIGINT                                   |
| product discount price       | `product.discountPrice`                               | `product.discountPrice`                                             | `context_product_discount_price`              | BIGINT                                   |
| product url path             | `product.urlPath`                                     | `product.urlPath`                                                   | `context_product_url_path`                    |                                           |
| element metadata             | `element.{tag,id,role,text,dataset}`                  | `element...`                                                        | -                                             | Not stored (needs schema change)        |
| ingest metadata              | -                                                     | `_ingest.{receivedAt,sourceIp,userAgent,method,path,requestId,apiId,stage,traceId}` | -                              | Not stored; available during ETL        |
